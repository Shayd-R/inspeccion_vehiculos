<form id="firmaForm" action="/guardar-firma" method="post">
    <canvas id="firmaCanvas" width="400" height="200"></canvas>
    <button type="submit">Guardar Firma</button>
</form>
<script>
    const firmaForm = document.getElementById('firmaForm');
    const canvas = document.getElementById('firmaCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.strokeStyle = 'black';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.stroke();

        [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    canvas.addEventListener('mouseup', () => {
        isDrawing = false;
    });

    canvas.addEventListener('mouseout', () => {
        isDrawing = false;
    });

    firmaForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const firmaImagen = canvas.toDataURL('image/png');

        // Agregar la firma como un campo en el formulario antes de enviarlo
        const firmaInput = document.createElement('input');
        firmaInput.type = 'hidden';
        firmaInput.name = 'firma';
        firmaInput.value = firmaImagen;
        firmaForm.appendChild(firmaInput);

        // EnvÃ­a el formulario con la firma al servidor
        fetch('/guardar-firma', {
            method: 'POST',
            body: new FormData(firmaForm),
        })
            .then((response) => response.text())
            .then((message) => {
                alert(message);
            })
            .catch((error) => {
                console.error('Error al guardar la firma:', error);
            });
    });

</script>